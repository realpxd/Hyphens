<!DOCTYPE html>
<html lang="en">
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  <link rel="stylesheet" href="../credentials/login.css">
</head>
<body>
    <section class="il-block">
        <img src="../assets/img/il-3.webp" class="illustration-main" alt="Illustration">
            	<p>Welcome Back!</p>
    </section>
    <main>
    <section class="container-main">
    <form id="container-login-form">
        <div class="blocks b-a">
          <input type="text" class="in-username" id="in-username" placeholder="Username" required>
          <input type="password" class="in-password" id="in-password" placeholder="Password" minlength="8" required>
          <p class="user-console
          " id="user-console"></p>
        </div> 
        <div class="blocks b-b">       
         <a href="../credentials/ForgotPass.html" class="reset"><span type="submit">Reset Password</span></a>
         <input type="submit" value="Log In" id="submit" class="submit">
        </div>
      </form>
    </section>
    </main>

    <script>
        const loginForm = document.getElementById('container-login-form');
        const inEmail = document.getElementById('in-username');
        const inPassword = document.getElementById('in-password');
        const userConsole = document.getElementById('user-console');
        const submit = document.getElementById('submit');
    </script>
    <script>
        loginForm.addEventListener('submit', async (e) => {
  e.preventDefault();

  const inEmailValue = inEmail.value;
    const inPasswordValue = inPassword.value;
console.log(inEmailValue + " " + inPasswordValue);
  const getUserData = async () => {
    let boolForLogin = false;
    console.log(boolForLogin + " hello");
    try {
      const response = await fetch(`https://naman77s.github.io/quizapi/userData.json`);
      console.log(response);
      if (!response.ok) {
        throw new Error(response.statusText);
      }
      const checkUserData = await response.json();
      checkUserData.forEach((user) => {
        console.log(user.userEmail + " " + inEmailValue);
        console.log(user.userPass + " " + inPasswordValue);
        if (user.userEmail === inEmailValue && user.userPass === inPasswordValue) {
          console.log(boolForLogin + " inside");
          boolForLogin = true;
          console.log(user.userEmail + " " + inEmailValue);
          console.log(user.userPass + " " + inPasswordValue);
        }
      });
    } catch (error) {
      console.error(error);
    }
    console.log(boolForLogin + " outside");
    return boolForLogin;
  };

  const checkCredentials = async () => {
    const boolForLogin = await getUserData();
    console.log(boolForLogin + " outside");
    return boolForLogin;
  };

  const isLoginSuccessful = await checkCredentials();
  if (isLoginSuccessful) {
    userConsole.innerHTML = "Login Successful";
    localStorage.setItem("inEmailValue", inEmailValue);
    localStorage.setItem("inPasswordValue", inPasswordValue);
    // console.log(localStorage.getItem("inEmailValue") + " t " + inEmailValue);
    // isLoginSuccessful = false;
    console.log(isLoginSuccessful + " outside");

    window.location.href = "../client-panel/index.html";
    // window.location.href = "index.html";
  } else {
    userConsole.innerHTML = "Credentials didn't match";
  }
});
    if(localStorage.getItem("inEmailValue") != null && localStorage.getItem("inPasswordValue") != null){
        window.location.href = "../client-panel/index.html";
        $(document.body).fadeOut(1000);
    }
    </script>
</body>
</html>